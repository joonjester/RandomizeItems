<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Box with Input Value</title>
    <style>
        .box {
            border: 2px solid #000;
            padding: 20px;
            width: 200px;
            text-align: center;
            margin: 10px;
            cursor: pointer; /* Change cursor to pointer to indicate clickable */
        }
    </style>
</head>
<body>

    <button id="createBoxBtn">Create Box</button>
    <button id="randomizeBtn">RANDOMIZEE</button>
    <input type="text" id="name" placeholder="What should be randomized">
    <input type="text" id="category" placeholder="What category is it">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

    let listOfItems = [];
    async function createItem(itemData) {
        try {
            const response = await axios.post('http://localhost:8080/api/items/createItem', itemData, {
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            console.log('Response:', response.data);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    async function getIdFromBox(boxDetails) {
        try {
            const response = await axios.post('http://localhost:8080/api/items/getIds', boxDetails, {
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            console.log('Response:', response.data);
            listOfItems.push(response.data)
            console.log(listOfItems)
        } catch (error) {
            console.error('Error:', error);
        }
    }

    document.getElementById("createBoxBtn").addEventListener("click", function() {
        // Retrieve the value of the input fields
        const inputName = document.getElementById("name").value;
        const inputCategory = document.getElementById("category").value;

        // Create data object
        const data = {
            name: inputName,
            category: inputCategory
        };

        // Call createItem function to send POST request
        createItem(data);

        // Create a new box element
        const box = document.createElement("div");
        box.classList.add("box");

        // Add text to the box
        const content = document.createTextNode(inputName + "\n" + inputCategory);
        box.appendChild(content);

        // Append the box to the body
        document.body.appendChild(box);

        var boxes = document.querySelectorAll('.box')

        boxes.forEach(function(box){
            box.addEventListener("click", function() {
                const boxId = getIdFromBox(data)
                alert("You just added "+ inputName)
            });
        })         
    });

    async function randomizeTheseItems(listItems) {
        try {
            const response = await axios.get('http://localhost:8080/api/items/randomize', {
                params: {
                    ids : listItems.join(',')
                }
            });
            const randomizedText = response.data;

            // Create an overlay div
            const overlay = document.createElement('div');
            overlay.classList.add('overlay');

            // Create a big text element
            const bigText = document.createElement('h1');
            bigText.textContent = randomizedText;

            // Append the big text element to the overlay
            overlay.appendChild(bigText);

            // Append the overlay to the body
            document.body.appendChild(overlay);
            } catch (error) {
                console.error('Error:', error);
            }
    }

    document.getElementById("randomizeBtn").addEventListener("click", function() {
        
        randomizeTheseItems(listOfItems)
    });

    async function displayAllItems() {
        try {
            // Make a GET request to fetch all items from the database
            const response = await axios.get('http://localhost:8080/api/items/allItems');

            // Loop through each item in the response data
            response.data.forEach(item => {
                // Create a new box element
                const box = document.createElement("div");
                box.classList.add("box");

                // Add text to the box
                const content = document.createTextNode(item.name + "\n" + item.category);
                box.appendChild(content);

                // Append the box to the body
                document.body.appendChild(box);
            });
        } catch (error) {
            console.error('Error fetching items:', error);
        }
    }

    window.addEventListener('load', function() {
        displayAllItems();
        const box = document.createElement("div");
        box.classList.add("box");

        var boxes = document.querySelectorAll('.box')

        boxes.forEach(function(box){
            box.addEventListener("click", function() {
                const boxId = getIdFromBox(data)
                alert("You just added "+ inputName)
            });
        }) 
    });
    </script>
</body>
</html>
